# Get the number of cores
include(ProcessorCount)
ProcessorCount(NPROC)

# target for python module build
ExternalProject_Add(
  pythonBindings
  DEPENDS ${VIENNAPS_DEPENDENCIES}
  SOURCE_DIR ${CMAKE_CURRENT_LIST_DIR}/Python
  UPDATE_COMMAND ""
  PATCH_COMMAND ""
  CMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}
             -DCMAKE_C_COMPILER=${CMAKE_C_COMPILER}
             -DCMAKE_CXX_COMPILER=${CMAKE_CXX_COMPILER}
             -DCMAKE_CXX_STANDARD=${CMAKE_CXX_STANDARD}
             -DCMAKE_CXX_EXTENSIONS=${CMAKE_CXX_EXTENSIONS}
             -DCMAKE_CXX_STANDARD_REQUIRED=${CMAKE_CXX_STANDARD_REQUIRED}
             -DCMAKE_VERBOSE_MAKEFILE=${CMAKE_VERBOSE_MAKEFILE}
             -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
             -DCMAKE_CXX_FLAGS=${CMAKE_CXX_FLAGS}
             -DCMAKE_CXX_FLAGS_DEBUG=${CMAKE_CXX_FLAGS_DEBUG}
             -DCMAKE_CXX_FLAGS_RELEASE=${CMAKE_CXX_FLAGS_RELEASE}
             # Paths
             -DViennaPS_BINARY_DIR=${ViennaPS_BINARY_DIR}
             -Dpybind11_DIR=${pybind11_DIR}
             # Variables and Options
             -DVIENNAPS_VERSION=${PROJECT_VERSION}
             -DVIENNAPS_BUILD_INCLUDE_DIRS=${VIENNAPS_BUILD_INCLUDE_DIRS}
  CMAKE_CACHE_ARGS
    -DCMAKE_CXX_FLAGS:STRING=${CMAKE_CXX_FLAGS} -DCMAKE_PREFIX_PATH:PATH=${CMAKE_PREFIX_PATH}
    -DCMAKE_INCLUDE_PATH:PATH=${CMAKE_INCLUDE_PATH} -DCMAKE_LIBRARY_PATH:PATH=${CMAKE_LIBRARY_PATH}
  BUILD_COMMAND ${CMAKE_COMMAND} --build . --parallel ${NPROC}
  TEST_COMMAND "")